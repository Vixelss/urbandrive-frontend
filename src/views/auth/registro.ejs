<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title><%= titulo %></title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/main.css">
</head>
<body>
    <%- include('../partials/header') %>

    <main class="auth-main">
        <section class="auth-card">
            <h1>Crear cuenta</h1>

            <% if (errores && errores.length) { %>
                <div class="auth-error">
                    <ul>
                        <% errores.forEach(e => { %>
                            <li><%= e %></li>
                        <% }) %>
                    </ul>
                </div>
            <% } %>

            <form method="post" action="/registro" novalidate>
                <div class="auth-grid">
                    <label class="campo">
                        Nombres
                        <input
                            type="text"
                            id="nombres"
                            name="nombres"
                            value="<%= valores.nombres || '' %>"
                            required
                            pattern="[A-Za-z√Å√â√ç√ì√ö√°√©√≠√≥√∫√ë√±\s]+"
                            title="Solo letras y espacios.">
                    </label>

                    <label class="campo">
                        Apellidos
                        <input
                            type="text"
                            id="apellidos"
                            name="apellidos"
                            value="<%= valores.apellidos || '' %>"
                            required
                            pattern="[A-Za-z√Å√â√ç√ì√ö√°√©√≠√≥√∫√ë√±\s]+"
                            title="Solo letras y espacios.">
                    </label>
                </div>

                <label class="campo">
                    Correo electr√≥nico
                    <input
                        type="email"
                        id="email"
                        name="email"
                        required
                        value="<%= valores.email || '' %>"
                        pattern="^[A-Za-z0-9._%+-]+@[A-Za-z0-9-]+\.(com|net|org|ec|es)$"
                        title="Ejemplo: usuario@gmail.com">
                </label>

                <label class="campo">
                    Tel√©fono
                    <input
                        type="text"
                        id="telefono"
                        name="telefono"
                        value="<%= valores.telefono || '' %>"
                        required
                        inputmode="numeric"
                        pattern="\d{9,10}"
                        title="Solo n√∫meros (9 a 10 d√≠gitos), sin signos ni espacios.">
                </label>

                <label class="campo">
                    Direcci√≥n
                    <input
                        type="text"
                        id="direccion"
                        name="direccion"
                        value="<%= valores.direccion || '' %>"
                        required
                        pattern="[A-Za-z√Å√â√ç√ì√ö√°√©√≠√≥√∫√ë√±0-9\s]+"
                        title="Solo letras, n√∫meros y espacios (sin caracteres especiales).">
                </label>

                <div class="auth-grid">
                    <label class="campo">
                        Pa√≠s
                        <select name="pais" required>
                            <option value="">Selecciona un pa√≠s</option>
                            <option value="Ecuador"
                                <%= valores.pais === 'Ecuador' ? 'selected' : '' %>>
                                Ecuador
                            </option>
                            <option value="United States"
                                <%= valores.pais === 'United States' ? 'selected' : '' %>>
                                Estados Unidos
                            </option>
                        </select>
                    </label>

                    <label class="campo">
                        Edad
                        <input
                            type="number"
                            id="edad"
                            name="edad"
                            value="<%= valores.edad || '' %>"
                            required
                            min="18"
                            max="90"
                            step="1"
                            title="Solo n√∫meros entre 18 y 90.">
                    </label>
                </div>

                <div class="auth-grid">
                    <label class="campo">
                        Tipo de identificaci√≥n
                        <select name="tipoIdentificacion" id="tipoIdentificacion" required>
                            <option value="">Selecciona...</option>
                            <option value="CI"
                                <%= valores.tipoIdentificacion === 'CI' ? 'selected' : '' %>>
                                C√©dula (Ecuador)
                            </option>
                            <option value="PASAPORTE"
                                <%= valores.tipoIdentificacion === 'PASAPORTE' ? 'selected' : '' %>>
                                Pasaporte
                            </option>
                            <option value="LICENCIA"
                                <%= valores.tipoIdentificacion === 'LICENCIA' ? 'selected' : '' %>>
                                Licencia de conducir
                            </option>
                        </select>
                    </label>

                    <label class="campo">
                        Identificaci√≥n
                        <input
                            type="text"
                            name="identificacion"
                            id="identificacion"
                            required
                            value="<%= valores.identificacion || '' %>">
                        <small id="identificacionHelp" class="texto-ayuda"></small>
                    </label>
                </div>

                <div class="auth-grid">
                    <label class="campo">
                        Contrase√±a
                        <div class="campo-password">
                            <input
                                type="password"
                                name="password"
                                id="reg-password"
                                required
                                minlength="8">
                            <button type="button" class="btn-toggle-pass" data-target="reg-password">üëÅ</button>
                        </div>
                        <small>Debe tener al menos 8 caracteres, con may√∫sculas, min√∫sculas y n√∫meros.</small>
                    </label>

                    <label class="campo">
                        Confirmar contrase√±a
                        <div class="campo-password">
                            <input
                                type="password"
                                name="confirmarPassword"
                                id="reg-password2"
                                required
                                minlength="8">
                            <button type="button" class="btn-toggle-pass" data-target="reg-password2">üëÅ</button>
                        </div>
                    </label>
                </div>

                <button type="submit" class="btn-auth-primary">Registrarme</button>
            </form>

            <p class="auth-link">
                ¬øYa tienes cuenta?
                <a href="/login">Iniciar sesi√≥n</a>
            </p>
        </section>
    </main>

    <script>
        // Mostrar / ocultar contrase√±as
        document.querySelectorAll('.btn-toggle-pass').forEach(function (btn) {
            btn.addEventListener('click', function () {
                const targetId = btn.dataset.target;
                const input = document.getElementById(targetId);
                if (!input) return;
                const isPassword = input.type === 'password';
                input.type = isPassword ? 'text' : 'password';
                btn.textContent = isPassword ? 'üôà' : 'üëÅ';
            });
        });

        // Validaci√≥n din√°mica de identificaci√≥n seg√∫n tipo
        const tipoSelect = document.getElementById('tipoIdentificacion');
        const identInput = document.getElementById('identificacion');
        const identHelp  = document.getElementById('identificacionHelp');

        function configurarIdentificacion() {
            if (!tipoSelect || !identInput || !identHelp) return;
            const tipo = tipoSelect.value;
            identInput.removeAttribute('pattern');
            identInput.removeAttribute('maxlength');

            if (tipo === 'CI') {
                identInput.pattern = '\\d{10}';
                identInput.maxLength = 10;
                identHelp.textContent = 'C√©dula ecuatoriana: exactamente 10 d√≠gitos num√©ricos.';
            } else if (tipo === 'PASAPORTE') {
                identInput.pattern = '[A-Za-z0-9]{6,15}';
                identInput.maxLength = 15;
                identHelp.textContent = 'Pasaporte: 6 a 15 caracteres alfanum√©ricos.';
            } else if (tipo === 'LICENCIA') {
                identInput.pattern = '[A-Za-z0-9-]{6,20}';
                identInput.maxLength = 20;
                identHelp.textContent = 'Licencia: 6 a 20 caracteres, letras, n√∫meros o guiones.';
            } else {
                identHelp.textContent = '';
            }
        }

        if (tipoSelect) {
            tipoSelect.addEventListener('change', configurarIdentificacion);
            configurarIdentificacion();
        }

        // Solo d√≠gitos en tel√©fono (m√°x 10)
        const telInput = document.getElementById('telefono');
        if (telInput) {
            telInput.addEventListener('input', function () {
                this.value = this.value.replace(/\D/g, '').slice(0, 10);
            });
        }

        // Solo d√≠gitos en edad, entre 18 y 90
        const edadInput = document.getElementById('edad');
        if (edadInput) {
            edadInput.addEventListener('input', function () {
                this.value = this.value.replace(/\D/g, '').slice(0, 2);
                if (this.value !== '') {
                    let n = parseInt(this.value, 10);
                    if (n < 18) n = 18;
                    if (n > 90) n = 90;
                    this.value = String(n);
                }
            });
        }
    </script>
</body>
</html>
